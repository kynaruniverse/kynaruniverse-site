<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" 
      name="viewport" 
    />
    
    <title>The Marketplace | Kynar Studio</title>
    
    <link href="styles.css" rel="stylesheet" />
    
    <script>
      (function() {
        const savedTheme = localStorage.getItem("kynar_theme");
        if (savedTheme === "dark" || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add("dark-mode");
        }
      })();
    </script>

    <script defer src="ui-core.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <meta content="website" property="og:type">
    <meta content="The Marketplace | Kynar Studio" property="og:title">
    <meta content="Premium digital assets for the creative elite." property="og:description">
    <meta content="https://www.kynaruniverse.co.uk/assets/images/og-preview.webp" property="og:image">
  </head>

  <body>

    <header class="app-header" id="global-header"></header>

    <main class="container">
      
      <div class="reveal-up" style="margin-top: 40px">
        <span class="text-accent text-upper text-bold text-sm" style="letter-spacing: 0.2em;">Kynar Shop</span>
        <h1>The Marketplace</h1>
        <p style="margin-top: 10px;">High-fidelity assets for digital creators.</p>
      </div>

      <nav class="filter-bar reveal-up" id="filterContainer">
        <button class="filter-chip active" data-cat="all">All Assets</button>
        <button class="filter-chip" data-cat="personal">Life & Flow</button>
        <button class="filter-chip" data-cat="work">Business & Growth</button>
        <button class="filter-chip" data-cat="creative">Content & Style</button>
        <button class="filter-chip" data-cat="education">Learning & Dev</button>
      </nav>

      <div id="shop-grid" class="grid-col-1 gap-xl"></div>
      
      <div id="emptyState" class="empty-state" style="display: none;">
        <div style="font-size: 3rem; margin-bottom: 20px;">ðŸ”­</div>
        <h3 class="text-display">Signal Lost</h3>
        <p>No assets found in this frequency.</p>
      </div>

    </main>

    <footer id="global-footer"></footer>
    
    <div id="productModal" class="nav-overlay flex-center" style="padding: 20px; display: none;">
      <div class="card" style="max-width: 800px; width: 100%; grid-template-columns: 1fr; position: relative; padding: 40px;">
        <button id="closeModal" class="nav-icon" style="position: absolute; top: 20px; right: 20px;">âœ•</button>
        <div id="modalContent"></div>
      </div>
    </div>

        <script type="module">
      import { VAULT } from './src/data/vault.js';
      import { renderCard } from './components/ProductCard.js';
      import { EventBus, EVENTS } from './src/core/events.js';

      const grid = document.getElementById('shop-grid');
      const emptyState = document.getElementById('emptyState');
      const filterBtns = document.querySelectorAll('.filter-chip');

      // --- RENDER LOGIC ---
      function renderGrid(category = 'all') {
        grid.style.opacity = '0';
        
        requestAnimationFrame(() => {
          const filtered = category === 'all' 
            ? VAULT 
            : VAULT.filter(p => p.category.toLowerCase() === category.toLowerCase());

          if (filtered.length === 0) {
            emptyState.style.display = 'block';
            grid.innerHTML = '';
          } else {
            emptyState.style.display = 'none';
            grid.innerHTML = filtered.map(p => renderCard(p)).join('');
          }

          grid.style.opacity = '1';
          setTimeout(() => {
            document.querySelectorAll('.reveal-up').forEach(el => el.classList.add('reveal-visible'));
          }, 50);
        });
      }

      // --- FILTER LOGIC ---
      function updateActiveFilter(category) {
        filterBtns.forEach(btn => {
          if (btn.dataset.cat === category) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      }

      // --- EVENT HANDLERS ---
      document.getElementById('filterContainer').addEventListener('click', (e) => {
        const btn = e.target.closest('.filter-chip');
        if (!btn) return;
        
        const category = btn.dataset.cat;
        updateActiveFilter(category);
        renderGrid(category);
        
        if(navigator.vibrate) navigator.vibrate(10);
      });

      // --- INITIALIZATION ---
      document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const cat = params.get('cat') || 'all';
        
        updateActiveFilter(cat);
        renderGrid(cat);
      });
    </script>


  </body>
</html>
