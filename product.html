<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Product Details | Kynar Studio</title>
    <link href="styles.css" rel="stylesheet" />
    
    <script src="ui-core.js" defer></script>
    <script src="https://assets.lemonsqueezy.com/lemon.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <style>
      .product-hero-img {
        width: 100%;
        display: block;
        opacity: 0;
        transition: opacity 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        will-change: opacity;
      }
      body:not(.dark-mode) .product-hero-img { mix-blend-mode: multiply; }

      .img-skeleton {
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Ensure the sticky CTA is hidden initially and ready for JS */
      .mobile-sticky-cta.visible {
        transform: translateY(0) !important;
      }
    </style>
  
    <meta property="og:type" content="product">
    <meta property="og:title" content="Archive Entry | Kynar Studio">
    <meta property="og:description" content="Secure access to Kynar Studio high-fidelity digital assets.">
    <meta property="og:url" content="https://www.kynaruniverse.co.uk/product.html">
  
  </head>

  <body>
    <header class="app-header" id="global-header"></header>

    <main class="container" id="product-content">
      <div class="reveal-up" style="text-align: center; padding: 120px 0;">
        <p style="font-family: var(--font-display); letter-spacing: 0.2em; font-size: 0.8rem; opacity: 0.5; text-transform: uppercase;">System Handshake: Initializing...</p>

      </div>
    </main>

    <footer class="app-footer" id="global-footer"></footer>

    <script type="module">
      import { getProduct } from './vault.js';

      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const productId = params.get("id");
        const product = getProduct(productId);

        if (product) {
          renderProduct(product);
        } else {
          window.location.href = "shop.html";
        }
      });

            function renderProduct(p) {
        const container = document.getElementById("product-content");
        document.title = `${p.title} | Kynar Studio`;

        container.innerHTML = `
          <div class="product-master-layout" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(min(100%, 450px), 1fr)); gap: clamp(40px, 8vw, 80px); align-items: start;">
            
            <div class="reveal-up img-skeleton" style="position: sticky; top: 100px;">
              <div style="background: ${p.bg}; border-radius: clamp(24px, 5vw, 40px); width: 100%; padding: 12%; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; overflow: hidden; box-shadow: var(--shadow-depth);">
                <img src="${p.image}" alt="${p.title}" class="product-hero-img" style="width: 100%; height: 100%; object-fit: contain;" onload="this.style.opacity='1'">
              </div>
            </div>
            
            <div class="reveal-up" style="padding-bottom: 120px;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                 <span style="height: 1px; width: 30px; background: var(--accent-gold);"></span>
                 <span style="font-size: 0.75rem; font-weight: 800; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.3em;">${p.tag}</span>
              </div>
              
              <h1 id="product-title" style="margin-bottom: 24px;">${p.title}</h1>
              <p style="font-size: clamp(1.1rem, 3vw, 1.25rem); line-height: 1.6; margin-bottom: 40px; color: var(--ink-medium);">${p.desc}</p>
              
              <div style="margin-bottom: 48px; border-top: 1px solid rgba(0,0,0,0.06); padding-top: 32px;">
                <h4 style="font-family: var(--font-display); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.5; margin-bottom: 24px;">Included in Archive:</h4>
                <ul style="list-style: none; display: grid; gap: 20px;">
                  ${p.features.map(f => `
                    <li style="display: flex; align-items: center; gap: 16px; font-size: 1rem; color: var(--ink-deep); font-weight: 500;">
                      <div style="width: 6px; height: 6px; border-radius: 50%; background: var(--accent-gold);"></div>
                      ${f}
                    </li>
                  `).join('')}
                </ul>
              </div>

              <div style="background: var(--bg-surface); padding: clamp(24px, 5vw, 40px); border-radius: 32px; border: 1px solid rgba(0,0,0,0.04); box-shadow: var(--shadow-float);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
                  <div>
                    <div class="live-signal" style="margin-bottom: 12px; font-size: 0.6rem; font-weight: 900; letter-spacing: 0.15em; color: var(--accent-gold); display: flex; align-items: center; gap: 8px;">
                <div style="width: 6px; height: 6px; border-radius: 50%; background: var(--accent-gold); animation: pulse-border 2s infinite;"></div>
                ARCHIVE SIGNAL: ACTIVE
              </div>

                    <span style="display: block; font-size: 0.65rem; font-weight: 800; opacity: 0.4; letter-spacing: 0.1em; margin-bottom: 4px;">SINGLE USER LICENSE</span>
                    <span style="font-family: var(--font-display); font-size: 2.2rem;">${p.price}</span>
                  </div>
                  <span style="font-size: 0.7rem; color: var(--accent-gold); font-weight: 800; border: 1px solid var(--accent-gold); padding: 4px 10px; border-radius: 4px;">V6.5 READY</span>
                </div>
                
                ${p.status === 'coming-soon' ? renderWaitlist(p) : `
                  <div style="display: grid; gap: 12px;">
                    <a href="${p.checkout}" class="btn-primary" style="height: 64px; font-size: 1rem;">${p.actionLabel || 'Authorize Download'}</a>
                    <button id="save-btn" onclick="saveToArchive('${p.id}')" class="btn-ghost" style="height: 56px; width: 100%;">Save to Archive</button>
                    ${p.previewUrl && p.previewUrl !== "#" ? `<a href="${p.previewUrl}" target="_blank" style="text-align: center; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; color: var(--ink-medium); text-decoration: none; margin-top: 10px; letter-spacing: 0.1em;">Launch Interactive Preview â†’</a>` : ''}
                  </div>
                `}
              </div>
            </div>
          </div>

          <div class="mobile-sticky-cta" id="sticky-anchor" style="padding: 16px 24px; background: var(--bg-glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border-top: 1px solid rgba(15, 61, 48, 0.08); display: flex; align-items: center; gap: 16px; position: fixed; bottom: 0; left: 0; width: 100%; z-index: 2000; transform: translateY(100%); transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);">

             <div style="flex-shrink: 0;">
                <span style="display: block; font-size: 0.55rem; font-weight: 800; opacity: 0.5;">${p.title}</span>
                <span style="font-family: var(--font-display); font-size: 1.1rem;">${p.price}</span>
             </div>
             <a href="${p.checkout}" onclick="if(navigator.vibrate) navigator.vibrate([15, 30]);" class="btn-primary" style="flex-grow: 1; height: 50px; font-size: 0.8rem; justify-content: center;">${p.status === 'coming-soon' ? 'Notify Me' : (p.actionLabel || 'Authorize')}</a>


          </div>
        `;

        // Animation Handshake
        setTimeout(() => {
          document.querySelectorAll(".reveal-up").forEach(el => el.classList.add("reveal-visible"));
          if (window.initMobileStickyCTA) window.initMobileStickyCTA();
        }, 100);
      }


            function renderWaitlist(p) {
        return `
          <div style="background: var(--bg-surface); padding: 32px; border-radius: 24px; text-align: center; border: 1.5px solid var(--accent-gold); animation: pulse-border 3s infinite;">
            <p style="font-weight: 900; font-size: 0.7rem; color: var(--accent-gold); letter-spacing: 0.2em; margin-bottom: 12px; text-transform: uppercase;">${p.actionLabel || 'Engineering Mode'}</p>
            <p style="font-size: 0.9rem; opacity: 0.6; color: var(--ink-deep); font-weight: 500;">Secure encryption in progress. This archive is currently being populated.</p>
          </div>
        `;
      }

    </script>
  </body>
</html>

