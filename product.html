<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" 
      name="viewport" 
    />
    
    <title>Product Details | Kynar Studio</title>
    
    <link href="styles.css" rel="stylesheet" />
    <script defer src="ui-core.js"></script>
    <script defer src="https://assets.lemonsqueezy.com/lemon.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <style>
      .product-hero-img {
        display: block;
        opacity: 0;
        transition: opacity 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        width: 100%;
        will-change: opacity;
      }
      body:not(.dark-mode) .product-hero-img { mix-blend-mode: multiply; }

      .img-skeleton {
        align-items: center;
        display: flex;
        justify-content: center;
        min-height: 300px;
      }
      
      /* Ensure the sticky CTA transition is primed */
      .mobile-sticky-cta.visible {
        transform: translateY(0) !important;
      }
    </style>
  
    <meta content="product" property="og:type">
    <meta content="Archive Entry | Kynar Studio" property="og:title">
    <meta content="Secure access to Kynar Studio high-fidelity digital assets." property="og:description">
    <meta content="https://www.kynaruniverse.co.uk/product.html" property="og:url">
  </head>

  <body>

    <header class="app-header" id="global-header"></header>

    <main class="container" id="product-content">
      <div 
        class="reveal-up" 
        style="
          padding: 120px 0; 
          text-align: center;
        "
      >
        <p 
          style="
            font-family: var(--font-display); 
            font-size: 0.8rem; 
            letter-spacing: 0.2em; 
            opacity: 0.5; 
            text-transform: uppercase;
          "
        >
          System Handshake: Initializing...
        </p>
      </div>
    </main>

    <footer class="app-footer" id="global-footer"></footer>

    <script type="module">
      import { getProduct } from './vault.js';

      // Global Handshake for Cross-Module Compatibility
      window.renderProduct = renderProduct;
      window.renderWaitlist = renderWaitlist;

      // #region [ 1. INITIALIZATION ]
      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const productId = params.get("id");
        const product = getProduct(productId);

        if (product) {
          renderProduct(product);
        } else {
          // Haptic Recovery: Redirect on invalid ID
          window.location.href = "shop.html";
        }
      });
      // #endregion

      // #region [ 2. RENDER ENGINE ]
      function renderProduct(p) {
        const container = document.getElementById("product-content");
        document.title = `${p.title} | Kynar Studio`;

        container.innerHTML = `
          <div 
            class="product-master-layout" 
            style="
              align-items: start;
              display: grid; 
              gap: clamp(40px, 8vw, 80px); 
              grid-template-columns: repeat(auto-fit, minmax(min(100%, 450px), 1fr)); 
            "
          >
            
            <div 
              class="reveal-up img-skeleton" 
              style="
                position: sticky; 
                top: 100px;
              "
            >
              <div 
                style="
                  align-items: center; 
                  aspect-ratio: 1/1; 
                  background: ${p.bg}; 
                  border-radius: clamp(24px, 5vw, 40px); 
                  box-shadow: var(--shadow-depth);
                  display: flex; 
                  justify-content: center; 
                  overflow: hidden; 
                  padding: 12%; 
                  width: 100%; 
                "
              >
                <img 
                  alt="${p.title}" 
                  class="product-hero-img" 
                  onload="this.style.opacity='1'"
                  src="${p.image}" 
                  style="
                    height: 100%; 
                    object-fit: contain; 
                    width: 100%; 
                  " 
                >
              </div>
            </div>
            
            <div 
              class="reveal-up" 
              style="padding-bottom: 120px;"
            >
              <div 
                style="
                  align-items: center; 
                  display: flex; 
                  gap: 12px; 
                  margin-bottom: 20px;
                "
              >
                 <span style="background: var(--accent-gold); height: 1px; width: 30px;"></span>
                 <span 
                   style="
                     color: var(--accent-gold); 
                     font-size: 0.75rem; 
                     font-weight: 800; 
                     letter-spacing: 0.3em; 
                     text-transform: uppercase;
                   "
                 >${p.tag}</span>
              </div>
              
              <h1 id="product-title" style="margin-bottom: 24px;">${p.title}</h1>
              <p 
                style="
                  color: var(--ink-medium);
                  font-size: clamp(1.1rem, 3vw, 1.25rem); 
                  line-height: 1.6; 
                  margin-bottom: 40px; 
                "
              >${p.desc}</p>
              
              <div 
                style="
                  border-top: 1px solid rgba(0,0,0,0.06); 
                  margin-bottom: 48px; 
                  padding-top: 32px;
                "
              >
                <h4 
                  style="
                    font-family: var(--font-display); 
                    font-size: 0.7rem; 
                    letter-spacing: 0.1em; 
                    margin-bottom: 24px;
                    opacity: 0.5; 
                    text-transform: uppercase; 
                  "
                >Included in Archive:</h4>
                <ul style="display: grid; gap: 20px; list-style: none;">
                  ${p.features.map(f => `
                    <li 
                      style="
                        align-items: center; 
                        color: var(--ink-deep); 
                        display: flex; 
                        font-size: 1rem; 
                        font-weight: 500;
                        gap: 16px; 
                      "
                    >
                      <div style="background: var(--accent-gold); border-radius: 50%; height: 6px; width: 6px;"></div>
                      ${f}
                    </li>
                  `).join('')}
                </ul>
              </div>

              <div 
                style="
                  background: var(--bg-surface); 
                  border: 1px solid rgba(0,0,0,0.04); 
                  border-radius: 32px; 
                  box-shadow: var(--shadow-float);
                  padding: clamp(24px, 5vw, 40px); 
                "
              >
                <div 
                  style="
                    align-items: flex-start; 
                    display: flex; 
                    justify-content: space-between; 
                    margin-bottom: 32px;
                  "
                >
                  <div>
                    <div 
                      class="live-signal" 
                      style="
                        align-items: center; 
                        color: var(--accent-gold); 
                        display: flex; 
                        font-size: 0.6rem; 
                        font-weight: 900; 
                        gap: 8px;
                        letter-spacing: 0.15em; 
                        margin-bottom: 12px; 
                      "
                    >
                      <div style="animation: pulse-border 2s infinite; background: var(--accent-gold); border-radius: 50%; height: 6px; width: 6px;"></div>
                      ARCHIVE SIGNAL: ACTIVE
                    </div>
                    <span 
                      style="
                        display: block; 
                        font-size: 0.65rem; 
                        font-weight: 800; 
                        letter-spacing: 0.1em; 
                        margin-bottom: 4px;
                        opacity: 0.4; 
                      "
                    >SINGLE USER LICENSE</span>
                    <span style="font-family: var(--font-display); font-size: 2.2rem;">${p.price}</span>
                  </div>
                  <span 
                    style="
                      border: 1px solid var(--accent-gold); 
                      border-radius: 4px;
                      color: var(--accent-gold); 
                      font-size: 0.7rem; 
                      font-weight: 800; 
                      padding: 4px 10px; 
                    "
                  >V6.5 READY</span>
                </div>
                
                ${p.status === 'coming-soon' ? renderWaitlist(p) : `
                  <div style="display: grid; gap: 12px;">
                    <a 
                      class="btn-primary" 
                      href="${p.checkout}" 
                      style="font-size: 1rem; height: 64px;"
                    >${p.actionLabel || 'Authorize Download'}</a>
                    
                    <button 
                      class="btn-ghost" 
                      id="save-btn" 
                      onclick="saveToArchive('${p.id}')" 
                      style="height: 56px; width: 100%;"
                    >Save to Archive</button>
                    
                    ${p.previewUrl && p.previewUrl !== "#" ? `
                      <a 
                        href="${p.previewUrl}" 
                        style="
                          color: var(--ink-medium); 
                          font-size: 0.7rem; 
                          font-weight: 800; 
                          letter-spacing: 0.1em;
                          margin-top: 10px; 
                          text-align: center; 
                          text-decoration: none; 
                          text-transform: uppercase; 
                        " 
                        target="_blank" 
                      >Launch Interactive Preview â†’</a>` : ''}
                  </div>
                `}
              </div>
            </div>
          </div>

          <div 
            class="mobile-sticky-cta" 
            id="sticky-anchor" 
            style="
              align-items: center; 
              backdrop-filter: blur(25px); 
              -webkit-backdrop-filter: blur(25px); 
              background: var(--bg-glass); 
              border-top: 1px solid rgba(15, 61, 48, 0.08); 
              bottom: 0; 
              display: flex; 
              gap: 16px; 
              left: 0; 
              padding: 16px 24px; 
              position: fixed; 
              transform: translateY(100%); 
              transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
              width: 100%; 
              z-index: 2000; 
            "
          >
             <div style="flex-shrink: 0;">
                <span style="display: block; font-size: 0.55rem; font-weight: 800; opacity: 0.5;">${p.title}</span>
                <span style="font-family: var(--font-display); font-size: 1.1rem;">${p.price}</span>
             </div>
             <a 
               class="btn-primary" 
               href="${p.checkout}" 
               onclick="if(navigator.vibrate) navigator.vibrate([15, 30]);" 
               style="flex-grow: 1; font-size: 0.8rem; height: 50px; justify-content: center;"
             >${p.status === 'coming-soon' ? 'Notify Me' : (p.actionLabel || 'Authorize')}</a>
          </div>
        `;

        // Synchronized Animation Handshake
        requestAnimationFrame(() => {
          const elements = document.querySelectorAll(".reveal-up");
          elements.forEach((el, i) => {
            setTimeout(() => el.classList.add("reveal-visible"), i * 100);
          });
          
          if (typeof window.initMobileStickyCTA === 'function') window.initMobileStickyCTA();
          if (typeof window.initStudioHaptics === 'function') window.initStudioHaptics();
        });
      }
      // #endregion

      // #region [ 3. SUB-COMPONENTS ]
      function renderWaitlist(p) {
        return `
          <div 
            style="
              animation: pulse-border 3s infinite;
              background: var(--bg-surface); 
              border: 1.5px solid var(--accent-gold); 
              border-radius: 24px; 
              padding: 32px; 
              text-align: center; 
            "
          >
            <p 
              style="
                color: var(--accent-gold); 
                font-size: 0.7rem; 
                font-weight: 900; 
                letter-spacing: 0.2em; 
                margin-bottom: 12px; 
                text-transform: uppercase;
              "
            >${p.actionLabel || 'Engineering Mode'}</p>
            <p 
              style="
                color: var(--ink-deep); 
                font-size: 0.9rem; 
                font-weight: 500;
                opacity: 0.6; 
              "
            >Secure encryption in progress. This archive is currently being populated.</p>
          </div>
        `;
      }
      // #endregion
    </script>
  </body>
</html>
