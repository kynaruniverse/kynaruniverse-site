<footer class="app-footer">
  <div class="footer-inner">
    
    <div class="footer-brand-col">
      <a href="index.html" class="footer-logo">KYNAR</a>
      
      <p class="footer-desc">
        High-performance digital systems for creators, entrepreneurs, and professional workflows.
      </p>

      <form class="sub-form" id="footer-sub-form">
        <div class="input-wrapper">
          <input type="email" id="footer-email" placeholder="Enter your email..." required class="sub-input">
          <button type="submit" class="sub-btn" id="footer-sub-btn" aria-label="Subscribe">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </button>
        </div>
        <span class="sub-note" id="footer-msg">Join the network. No spam, ever.</span>
      </form>
      
      <div class="social-row">
        <a href="#" class="social-btn" aria-label="X (Twitter)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4l11.733 16h4.267l-11.733 -16z"></path><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path></svg>
        </a>
        <a href="#" class="social-btn" aria-label="Instagram">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
        </a>
      </div>
    </div>

    <div class="footer-nav-col">
      <span class="footer-heading">Collections</span>
      <nav class="footer-links-grid">
        <a href="shop.html">Marketplace</a>
        <a href="library.html">Manuals</a>
        <a href="newsletter.html">The Network</a>
        <a href="account.html">Member Vault</a>
      </nav>
    </div>

    <div class="footer-sys-col">
      <span class="footer-heading">System Status</span>
      
      <div class="status-line">
        <span class="live-beacon"></span>
        <span class="status-text">Infrastructure Active</span>
      </div>

      <div class="legal-block">
        <span>&copy; <span id="year-display">2025</span> KYNAR DIGITAL V1.0</span>
        <div class="legal-links">
          <a href="#">Privacy Protocol</a>
          <span class="separator">/</span>
          <a href="#">Terms</a>
        </div>
      </div>
    </div>

  </div>
</footer>

<script type="module">
  import { supabase } from './supabase-config.js';

  // 1. Year Updater
  const yearEl = document.getElementById("year-display");
  if(yearEl) yearEl.textContent = new Date().getFullYear();

  // 2. Newsletter Logic
  const form = document.getElementById("footer-sub-form");
  const msg = document.getElementById("footer-msg");
  const btn = document.getElementById("footer-sub-btn");
  const input = document.getElementById("footer-email");

  if (form) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = input.value;

      // UI Loading
      btn.innerHTML = `<span class="spinner" style="width:12px; height:12px; border-width:2px;"></span>`;
      btn.disabled = true;

      try {
        // Insert into Supabase
        const { error } = await supabase
          .from('subscribers')
          .insert([{ email: email }]);

        if (error) throw error;

        // Success State
        msg.textContent = "Welcome to the network.";
        msg.style.color = "var(--accent-gold)";
        input.value = "";
        btn.innerHTML = "✓";
        
      } catch (err) {
        console.error("Sub Error:", err);
        // If error is duplicate key (already subscribed), treat as success
        if (err.code === '23505') {
            msg.textContent = "You are already on the list.";
        } else {
            msg.textContent = "Connection failed. Try again.";
            msg.style.color = "var(--accent-red)";
        }
        btn.innerHTML = "✕";
      } finally {
        setTimeout(() => {
            btn.disabled = false;
            if(btn.innerHTML === "✕") btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>`;
        }, 3000);
      }
    });
  }
</script>
