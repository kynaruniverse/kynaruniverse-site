<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Security-Policy" content="
  default-src 'self'; 
  script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://assets.lemonsqueezy.com; 
  style-src 'self' 'unsafe-inline'; 
  img-src 'self' data: https:; 
  font-src 'self';
  connect-src 'self' https://formspree.io https://*.lemonsqueezy.com;
">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Kynar Studio">
    <link rel="canonical" href="https://www.kynaruniverse.co.uk/CURRENT_PAGE.html">

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Access Gateway | Kynar Studio</title>
    <link href="styles.css" rel="stylesheet" />
    <script type="module" src="ui-core.js"></script>

    <style>
      .vault-icon { font-size: 4rem; margin-bottom: 25px; animation: float 3s ease-in-out infinite; display: inline-block; }
      .verifying { border-style: dashed !important; animation: pulse-border 2s infinite; }
    </style>
  </head>

  <body>
    <header class="app-header" id="global-header"></header>

    <main class="container flex-col flex-center text-center" style="min-height: 85vh;">
      <div class="reveal-up" style="max-width: 500px; width: 100%;">
        
        <div class="vault-icon" id="status-icon">ðŸ“¦</div>

        <span id="security-label" class="text-accent text-upper text-bold text-xs" style="letter-spacing: 0.25em; display: block; margin-bottom: 20px;">Initialising Gateway</span>

        <h1 id="claim-title">
          Preparing Your <br /><span class="text-faded">Assets.</span>
        </h1>

        <p id="download-meta" class="text-sm" style="margin-bottom: 45px;">
          Verifying security certificates and generating your unique access token...
        </p>

        <div id="action-cluster" class="flex-col gap-sm" style="opacity: 0; pointer-events: none; transition: opacity 0.5s ease;">
          <a class="btn btn--primary w-full" id="downloadBtn" href="#">Download Package Now</a>
          <a class="btn btn--ghost w-full" href="shop.html">Return to Marketplace</a>
        </div>

        <div id="security-box" class="card verifying" style="margin-top: 50px; padding: 25px;">
           <p class="text-xs text-faded">
            ðŸ”’ <strong>Security Protocol:</strong> Access links are valid for 24 hours.
          </p>
        </div>

      </div>
    </main>

    <footer id="global-footer"></footer>
    
        <script type="module">
      import { getProduct } from './src/data/vault.js';

      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const productId = params.get("id");
        
        setTimeout(() => {
            const product = getProduct(productId);
            // Default to starter pack if no ID
            const activeProduct = product || { title: "Starter Pack", file: "kynar-starter-pack.zip" };

            // Success State
            document.getElementById("security-label").textContent = "Security Verified";
            document.getElementById("claim-title").innerHTML = `Your Assets Are <br /><span class="text-faded">Ready.</span>`;
            document.getElementById("download-meta").innerHTML = `The <strong>${activeProduct.title}</strong> package is decrypted.`;
            document.getElementById("status-icon").textContent = "ðŸ”“";
            
            const box = document.getElementById("security-box");
            box.classList.remove('verifying');
            box.style.borderStyle = "solid";
            box.style.borderColor = "var(--color-accent)";

            const actions = document.getElementById("action-cluster");
            actions.style.opacity = "1";
            actions.style.pointerEvents = "all";

            const btn = document.getElementById("downloadBtn");
            if (activeProduct.file) {
                btn.href = `./assets/downloads/${activeProduct.file}`;
                btn.setAttribute('download', activeProduct.file);
            }
            
            if(navigator.vibrate) navigator.vibrate([20, 40]);
        }, 1800); 
        
        setTimeout(() => document.querySelector('.reveal-up').classList.add('reveal-visible'), 100);
      });
    </script>

  </body>
</html>
