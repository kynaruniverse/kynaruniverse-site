<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Secure Delivery | Kynar Studio</title>
    <link href="styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    <script src="ui-core.js" defer></script>
    <style>
        .vault-icon {
            font-size: 4rem; 
            margin-bottom: 25px; 
            display: inline-block;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.05));
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
  </head>

  <body>
    <header class="app-header" id="global-header"></header>

    <main class="container" style="display: flex; align-items: center; justify-content: center; min-height: 85vh; text-align: center;">
      <div class="reveal-up" style="max-width: 500px; width: 100%">
        
        <div class="vault-icon" id="status-icon">ðŸ“¦</div>

        <span id="security-label" style="font-size: 0.75rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--accent-gold); font-weight: 800; display: block; margin-bottom: 20px;">
          Initialising Gateway
        </span>

        <h1 id="claim-title">Preparing Your <br /><span style="color: var(--ink-medium)">Archive.</span></h1>

        <p id="download-meta" style="margin: 25px 0 45px 0; font-size: 1.1rem; line-height: 1.6; color: var(--ink-medium);">
          Verifying security certificates and generating your unique access token...
        </p>

        <div id="action-cluster" style="display: flex; flex-direction: column; gap: 12px; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;">
          <a class="btn-primary" download href="#" id="downloadBtn" style="width: 100%; justify-content: center; letter-spacing: 0.1em;">
            Download Package Now
          </a>
          <a href="shop.html" class="btn-ghost" style="width: 100%; justify-content: center">
            Return to Marketplace
          </a>
        </div>

        <div style="margin-top: 50px; padding: 25px; border-radius: 20px; background: var(--bg-surface); border: 1.5px dashed rgba(15, 61, 48, 0.1);">
           <p style="font-size: 0.75rem; opacity: 0.6; line-height: 1.5;">
            ðŸ”’ <strong>Security Protocol:</strong> Access links are valid for 24 hours. <br> 
            For technical assistance, <a href="contact.html" style="color: var(--ink-deep); font-weight: 700; text-decoration: underline;">Connect with Support</a>
          </p>
        </div>
      </div>
    </main>

    <footer class="app-footer" id="global-footer"></footer>

    <script type="module">
      import { getProduct } from './vault.js';

      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const productId = params.get("id");
        const metaText = document.getElementById("download-meta");
        const securityLabel = document.getElementById("security-label");
        const claimTitle = document.getElementById("claim-title");
        const actionCluster = document.getElementById("action-cluster");
        const dlBtn = document.getElementById("downloadBtn");
        const icon = document.getElementById("status-icon");

        // GATEWAY LOGIC
        setTimeout(() => {
            // Find product or provide the Default Starter Kit if ID is missing/invalid
            const product = getProduct(productId) || { 
              title: "Essential Starter Pack", 
              file: "kynar-starter-pack.zip" 
            };
            
            const productName = product.title;

            // UI Transformation
            securityLabel.textContent = "Security Verified";
            securityLabel.style.color = "var(--ink-deep)";
            claimTitle.innerHTML = `Your Assets Are <br /><span style="color: var(--ink-medium)">Ready.</span>`;
            metaText.innerHTML = `The <strong>${productName}</strong> archive is now decrypted and prepared for download.`;
            icon.textContent = "ðŸ”“";
            
            // Activate Actions
            actionCluster.style.opacity = "1";
            actionCluster.style.pointerEvents = "all";

            // Secure Path Injection
            if (product.file) {
                dlBtn.href = `assets/downloads/${product.file}`;
            }

            if (dlBtn) {
              dlBtn.onclick = () => {
                if (navigator.vibrate) navigator.vibrate([100, 30, 100]);
              };
            }
        }, 1800); 
      });
    </script>
  </body>
</html>
